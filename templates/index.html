<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Data Extractor</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f4f8;
        }

        .container {
            margin-top: 50px;
        }
        .hyperlink{
            text-decoration:none;
            list-style: none;
        }

        .upload-section,
        .results-section {
            background-color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
        }

        .upload-section h3,
        .results-section h3 {
            color: #2c3e50;
        }

        .upload-section input,
        .upload-section button,
        .upload-section textarea,
        .upload-section select {
            width: 100%;
            margin-bottom: 15px;
        }

        .upload-section button {
            background-color: #3498db;
            color: white;
            border: none;
            font-weight: bold;
            padding: 12px;
            border-radius: 5px;
        }

        .upload-section button:hover {
            background-color: #2980b9;
        }

        .upload-section select {
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .upload-section textarea {
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .results-section {
            display: none;
        }

        .result-card {
            border: 1px solid #ecf0f1;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            background-color: #ecf0f1;
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .result-card h5 {
            font-size: 18px;
            color: #2c3e50;
            font-weight: 600;
        }

        .result-card p {
            font-size: 14px;
            color: #7f8c8d;
        }

        /* Navigation Bar */
        .navbar {
            background-color: #2c3e50;
        }

        .navbar .navbar-brand {
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .navbar .navbar-nav .nav-link {
            color: white;
            font-weight: 500;
        }

        .navbar .navbar-nav .nav-link:hover {
            color: #3498db;
        }

        /* Scrollbar Customization */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #ecf0f1;
        }

        .upload-section input[type="file"] {
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
        }

        /* Experience & Location Dropdowns */
        .upload-section select {
            font-size: 14px;
        }

        .filters-section {
            margin-bottom: 20px;
        }

        .filters-section input,
        .filters-section select {
            margin-right: 10px;
            width: auto;
        }

        .grid-view .result-card {
            display: inline-block;
            width: 45%;
            margin-right: 5%;
        }

        .table-view table {
            width: 100%;
            border-collapse: collapse;
        }

        .table-view th, .table-view td {
            padding: 15px;
            text-align: left;
            border: 1px solid #ddd;
        }

        .table-view th {
            background-color: #3498db;
            color: white;
        }
    </style>
</head>

<body>

        <!-- Modal -->
    <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfModalLabel">Resume</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- PDF iframe -->
                    <iframe id="pdfViewer" src="" width="100%" height="500px" frameborder="0"></iframe>
                </div>
            </div>
        </div>
    </div>


    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Resume Extractor</a>
        </div>
    </nav>

    <div class="container">

        <!-- Job Descriptions and Resume Upload Section -->
        <div class="upload-section">
            <h3>Upload Job Descriptions & Resumes</h3>

            <!-- Job Description -->
            <textarea id="jobDescription" placeholder="Enter Job Description" rows="5" required></textarea>

            <!-- Skills Set -->
            <input type="text" id="skillsSet" placeholder="Enter Required Skills (comma separated)" required>

            <!-- Experience -->
            <select id="minexperience" required>
                <option value="">Select Minimum Experience Level</option>
                <option value="0">Fresher</option>
                <option value="1">1 year</option>
                <option value="2">2 years</option>
                <option value="3">3 years</option>
                <option value="4">4 years</option>
                <option value="5">5 years</option>
                <option value="6">6 years</option>
                <option value="7">7 years</option>
                <option value="8">8 years</option>
                <option value="9">9 years</option>
                <option value="10">10 years</option>




            </select>

            <select id="maxexperience" required>
                <option value="">Select Maximum Experience Level</option>
                <option value="0">Fresher</option>
                <option value="1">1 year</option>
                <option value="2">2 years</option>
                <option value="3">3 years</option>
                <option value="4">4 years</option>
                <option value="5">5 years</option>
                <option value="6">6 years</option>
                <option value="7">7 years</option>
                <option value="8">8 years</option>
                <option value="9">9 years</option>
                <option value="10">10 years</option>

            </select>

            <!-- Location -->
            <!-- <select id="location" required>
                <option value="">Select Location</option>
                <option value="Remote">Remote</option>
                <option value="New York">New York</option>
                <option value="San Francisco">San Francisco</option>
                <option value="London">London</option>
                <option value="Mumbai">Mumbai</option>
            </select> -->

            <!-- Resume Upload -->
            <input type="file" id="resumes" multiple accept=".pdf,.docx,.txt,.doc" required>
            
            <!-- Submit Button -->
            <button id="submitBtn">Process Resumes</button>
        </div>

        <!-- Extracted Data Section -->
        <div class="results-section">
            <h3>Extracted Resume Data</h3>
            <div class="filters-section">
                <span><b>Filters:</b></span>
                <br>
                <br>
                <label><b>Name:</b></label>
                <input type="text" id="filterName" placeholder="Filter by Name">
                <label><b>Minimum Experience:</b></label>
                <input type="number" step="any" id="minfilterExperience" placeholder="Filter by Experience (Minimum)" value="0" min="1" max="100">
                <label><b>Maximum Experience:</b></label>
                <input type="number" step="any" id="maxfilterExperience" placeholder="Filter by Experience (Maximum)" value="1" min="1" max="100">
                <br>
                <br>

                <label><b>Minimum Score:</b></label>
                <input type="number" step="any" id="minScore" placeholder="Filter by Score (Minimum)" value="1" min="1" max="100">
                <label><b>Maximum Score:</b></label>
                <input type="number" step="any" id="maxScore" placeholder="Filter by Score (Maximum)" value="100" min="1" max="100">
                <br>
                <br>

                <button id="gridViewBtn">Grid View</button>
                <button id="tableViewBtn">Table View</button>
            </div>

            <div id="resultsContainer" class="grid-view">
                <!-- Extracted Data Cards will be displayed here -->
            </div>

            <div id="TableresultsContainer">
                <!-- Extracted Data Cards will be displayed here -->
            </div>
        </div>

    </div>

    <script>
        // Button click listener to process data
        document.getElementById('submitBtn').addEventListener('click', async () => {
            const jobDescription = document.getElementById('jobDescription').value;
            const skillsSet = document.getElementById('skillsSet').value.split(',');
            const minexperience = document.getElementById('minexperience').value;
            const maxexperience = document.getElementById('maxexperience').value;
            // const location = document.getElementById('location').value;
            const files = document.getElementById('resumes').files;

            // Validate fields
            if (!jobDescription || !skillsSet || !minexperience || !maxexperience || files.length === 0) {
                alert("Please fill all the fields.");
                return;
            }

            // FormData to send as multipart/form-data
            const formData = new FormData();
            formData.append('jobDescription', jobDescription);
            formData.append('skillsSet', JSON.stringify(skillsSet));
            formData.append('minexperience', minexperience);
            formData.append('maxexperience', maxexperience);
            // formData.append('location', location);

            for (let i = 0; i < files.length; i++) {
                formData.append('resumes', files[i]);
            }

            try {
                // Make POST request to the backend
                const response = await fetch('/process_resumes', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // Hide the upload section
                    document.querySelector('.upload-section').style.display = 'none'; // block by me
                    document.getElementById('TableresultsContainer').style.display = 'none'
                    document.getElementById('gridViewBtn').style.display = 'none'

                    // Show the results section
                    document.querySelector('.results-section').style.display = 'block';

                    // Display extracted data
                    const resultsContainer = document.getElementById('resultsContainer');
                    resultsContainer.innerHTML = ''; // Clear previous data

                    const TableresultsContainer = document.getElementById('TableresultsContainer');
                    TableresultsContainer.innerHTML = ''; // Clear previous data

                    const card2 = document.createElement('table');
                    card2.className = 'result-card table table-bordered'; // You can use Bootstrap's table classes

                    const tableHeader = document.createElement('thead');
                    tableHeader.innerHTML = `
                        <tr>
                            <th>Name</th>
                            <th>Phone Number</th>
                            <th>Email</th>
                            <th>Experience</th>
                            <th>Skills</th>
                            <th>Score</th>
                        </tr>
                    `;
                    card2.appendChild(tableHeader);


                    data.resumes.forEach(resume => {
                        //eduaction_span = ``
                        // resume.Education.forEach(edu_data => {
                        //     if(edu_data.university){
                        //         eduaction_span += `
                        //         <p>College/University: ${edu_data.university}</p>
                        //         `
                        //     }
                        //     if(edu_data.degree){
                        //         eduaction_span += ` <p>Degree: ${edu_data.degree}</p> `
                        //     }

                        //     if(edu_data.duration){
                        //         eduaction_span += `
                        //         <p>Duration: ${edu_data.duration}</p>`
                        //     }
                        //     });

                            //<p><strong>Education:</strong> ${eduaction_span}</p>

                        
                        const card = document.createElement('div');
                        card.className = 'result-card';
                        card.innerHTML = `
                            <h5><a href='#' class="hyperlink" data-bs-toggle="modal" data-bs-target="#pdfModal" 
                                    onclick="openPDF('${resume.resume}')">${resume.Name}</a></h5>
                            <p><strong>Phone Number:</strong>${resume.Mobile}</p>
                            <p><strong>Email:</strong> <a href= "mailto: ${resume.Email}"> ${resume.Email}</a></p>
                            <p><strong>Experience:</strong> ${resume.Experience}</p>
                            <p><strong>Skills:</strong> ${resume.Skills.join(', ')}</p>
                            <p><strong>Score:</strong> ${resume.Score}%</p>
                        `;
                        resultsContainer.appendChild(card);


                        const tableBody = document.createElement('tbody');
                        tableBody.innerHTML = `
                            <tr class='result-card-table'>
                                <td><a href="#" class="hyperlink" data-bs-toggle="modal" data-bs-target="#pdfModal" onclick="openPDF('${resume.resume}')">${resume.Name}</a></td>
                                <td>${resume.Mobile}</td>
                                <td><a href="mailto:${resume.Email}">${resume.Email}</a></td>
                                <td>${resume.Experience}</td>
                                <td>${resume.Skills.join(', ')}</td>
                                <td>${resume.Score}%</td>
                            </tr>
                        `;
                        card2.appendChild(tableBody);

                        TableresultsContainer.appendChild(card2);
                    });
                } else {
                    alert("Error processing resumes.");
                }
            } catch (error) {
                alert("An error occurred.");
                console.error(error);
            }
        });

        // View toggle functionality
        document.getElementById('gridViewBtn').addEventListener('click', () => {
            document.getElementById('resultsContainer').classList.add('grid-view');
            document.getElementById('resultsContainer').classList.remove('table-view');
            document.getElementById('resultsContainer').style.display = 'block'
            document.getElementById('tableViewBtn').style.display = 'block'
            document.getElementById('TableresultsContainer').style.display = 'none'
            document.getElementById('gridViewBtn').style.display = 'none'


        });

        document.getElementById('tableViewBtn').addEventListener('click', () => {
            document.getElementById('resultsContainer').classList.add('table-view');
            document.getElementById('resultsContainer').classList.remove('grid-view');
            document.getElementById('resultsContainer').style.display = 'none'
            document.getElementById('TableresultsContainer').style.display = 'block'
            document.getElementById('gridViewBtn').style.display = 'block'
            document.getElementById('tableViewBtn').style.display = 'none'


        });

        // Filters functionality
        document.getElementById('filterName').addEventListener('input', filterData);
        document.getElementById('minfilterExperience').addEventListener('change', filterData);
        document.getElementById('maxfilterExperience').addEventListener('change', filterData);
        document.getElementById('maxScore').addEventListener('change', filterData);
        document.getElementById('minScore').addEventListener('change', filterData);



        // document.getElementById('filterLocation').addEventListener('change', filterData);

        function parseDuration(duration) {
            const regex = /(\d+)\s*years?\s*(\d+)?\s*months?/i; // Regex to extract years and months
            const matches = duration.match(regex);

            if (matches) {
                return {
                    years: parseInt(matches[1], 10) || 0, // Default to 0 if missing
                    months: parseInt(matches[2], 10) || 0 // Default to 0 if missing
                };
            }

            return { years: 0, months: 0 }; // Default object if format is invalid
        }

        function isDurationWithinYears(duration, minYear, maxYear) {
            // Convert the provided duration to years
            totalYears = duration.years + duration.months / 12;

            // Check if the duration is within the range
            return totalYears >= minYear && totalYears <= maxYear;
        }

        function checkPercentageInRange(percentage, minScore, maxScore) {

            // Remove any non-numeric characters except the percentage sign
            const cleanPercentage = percentage.replace(/[^0-9.]/g, '').trim();

            // Convert to float
            const percentageValue = parseFloat(cleanPercentage);

            // Check if the parsed value is a valid number
            if (isNaN(percentageValue)) {
                console.error("Invalid percentage format");
                return false; // Invalid percentage input
            }

            // Check if the percentage value is between min and max (inclusive)
            return percentageValue >= minScore && percentageValue <= maxScore;
        }

        function filterData() {
            const nameFilter = document.getElementById('filterName').value.toLowerCase();
            // const experienceFilter = document.getElementById('filterExperience').value;
            const minYear = document.getElementById('minfilterExperience').value;
            const maxYear = document.getElementById('maxfilterExperience').value;

            const minScore = document.getElementById('minScore').value;
            const maxScore = document.getElementById('maxScore').value;

            if(!minYear && !maxYear ){
                alert('Minimum Year and Maximum Year are required')
            }

            if(!minScore && !maxScore){
                alert('Minimum Score and Maximum Score are required')

            }

            // const locationFilter = document.getElementById('filterLocation').value;

            const resultCardsTable = document.querySelectorAll('tr.result-card-table');
            resultCardsTable.forEach(tablerowcard => {
                const name = tablerowcard.querySelector('td:nth-child(1) a').textContent.toLowerCase(); // Get the name from the first column
                experience = tablerowcard.querySelector('td:nth-child(4)').textContent.trim(); // Get experience from the fourth column
                score = tablerowcard.querySelector('td:nth-child(6)').textContent.trim(); // Get score from the sixth column
                experience = parseDuration(experience)

                let tablematches = true;

                if (nameFilter && !name.includes(nameFilter)) {
                    tablematches = false;
                }

                if (!isDurationWithinYears(experience, minYear, maxYear)){
                    tablematches = false;
                }

                if(!checkPercentageInRange(score,minScore,maxScore)){
                    tablematches = false;
                }
                

                if (tablematches) {
                    tablerowcard.style.display = '';
                } else {
                    tablerowcard.style.display = 'none';
                }
            });

            const resultCards = document.querySelectorAll('.result-card');
            resultCards.forEach(card => {
                const name = card.querySelector('h5').textContent.toLowerCase();
                experience = card.querySelector('p:nth-of-type(3)').textContent.trim();
                score = card.querySelector('p:nth-of-type(5)').textContent.trim();

                experience = parseDuration(experience)
                console.log("experience==>",experience)
                // const location = card.querySelector('p:nth-of-type(2)').textContent.split(':')[1].trim();

                let matches = true;

                if (nameFilter && !name.includes(nameFilter)) {
                    matches = false;
                }

                if (!isDurationWithinYears(experience, minYear, maxYear)){
                    matches = false;
                }

                if(!checkPercentageInRange(score,minScore,maxScore)){
                    matches = false;
                }
                

                if (matches) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });


           
        }
        function openPDF(pdfUrl) {
        document.getElementById('pdfViewer').src = pdfUrl;
    }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>
